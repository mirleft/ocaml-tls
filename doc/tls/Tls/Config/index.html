<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Config (tls.Tls.Config)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">tls</a> &#x00BB; <a href="../index.html">Tls</a> &#x00BB; Config</nav><header class="odoc-preamble"><h1>Module <code><span>Tls.Config</span></code></h1><p>Configuration of the TLS stack</p></header><nav class="odoc-toc"><ul><li><a href="#config-type">Config type</a></li><li><a href="#constructors">Constructors</a></li><li><a href="#note-on-alpn-protocol-selection">Note on ALPN protocol selection</a></li><li><a href="#utility-functions">Utility functions</a></li><li><a href="#internal-use-only">Internal use only</a></li></ul></nav><div class="odoc-content"><h2 id="config-type"><a href="#config-type" class="anchor"></a>Config type</h2><div class="odoc-spec"><div class="spec type anchored" id="type-certchain"><a href="#type-certchain" class="anchor"></a><code><span><span class="keyword">type</span> certchain</span><span> = <span><span class="xref-unresolved">X509</span>.Certificate.t list</span> * <span class="xref-unresolved">X509</span>.Private_key.t</span></code></div><div class="spec-doc"><p>certificate chain and private key of the first certificate</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-own_cert"><a href="#type-own_cert" class="anchor"></a><code><span><span class="keyword">type</span> own_cert</span><span> = </span><span>[ </span></code><ol><li id="type-own_cert.None" class="def variant constructor anchored"><a href="#type-own_cert.None" class="anchor"></a><code><span>| </span><span>`None</span></code></li><li id="type-own_cert.Single" class="def variant constructor anchored"><a href="#type-own_cert.Single" class="anchor"></a><code><span>| </span><span>`Single <span class="keyword">of</span> <a href="#type-certchain">certchain</a></span></code></li><li id="type-own_cert.Multiple" class="def variant constructor anchored"><a href="#type-own_cert.Multiple" class="anchor"></a><code><span>| </span><span>`Multiple <span class="keyword">of</span> <span><a href="#type-certchain">certchain</a> list</span></span></code></li><li id="type-own_cert.Multiple_default" class="def variant constructor anchored"><a href="#type-own_cert.Multiple_default" class="anchor"></a><code><span>| </span><span>`Multiple_default <span class="keyword">of</span> <a href="#type-certchain">certchain</a> * <span><a href="#type-certchain">certchain</a> list</span></span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>polymorphic variant of own certificates</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-session_cache"><a href="#type-session_cache" class="anchor"></a><code><span><span class="keyword">type</span> session_cache</span><span> = <span><a href="../Core/SessionID/index.html#type-t">Core.SessionID.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Core/index.html#type-epoch_data">Core.epoch_data</a> option</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ticket_cache"><a href="#type-ticket_cache" class="anchor"></a><code><span><span class="keyword">type</span> ticket_cache</span><span> = </span><span>{</span></code><ol><li id="type-ticket_cache.lookup" class="def record field anchored"><a href="#type-ticket_cache.lookup" class="anchor"></a><code><span>lookup : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Core/index.html#type-psk13">Core.psk13</a> * <a href="../Core/index.html#type-epoch_data">Core.epoch_data</a>)</span> option</span>;</span></code></li><li id="type-ticket_cache.ticket_granted" class="def record field anchored"><a href="#type-ticket_cache.ticket_granted" class="anchor"></a><code><span>ticket_granted : <span><a href="../Core/index.html#type-psk13">Core.psk13</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Core/index.html#type-epoch_data">Core.epoch_data</a> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></li><li id="type-ticket_cache.lifetime" class="def record field anchored"><a href="#type-ticket_cache.lifetime" class="anchor"></a><code><span>lifetime : int32;</span></code></li><li id="type-ticket_cache.timestamp" class="def record field anchored"><a href="#type-ticket_cache.timestamp" class="anchor"></a><code><span>timestamp : <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ptime</span>.t;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-config"><a href="#type-config" class="anchor"></a><code><span><span class="keyword">type</span> config</span><span> = <span class="keyword">private</span> </span><span>{</span></code><ol><li id="type-config.ciphers" class="def record field anchored"><a href="#type-config.ciphers" class="anchor"></a><code><span>ciphers : <span><a href="../Ciphersuite/index.html#type-ciphersuite">Ciphersuite.ciphersuite</a> list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>ordered list (regarding preference) of supported cipher suites</p><span class="comment-delim">*)</span></div></li><li id="type-config.protocol_versions" class="def record field anchored"><a href="#type-config.protocol_versions" class="anchor"></a><code><span>protocol_versions : <a href="../Core/index.html#type-tls_version">Core.tls_version</a> * <a href="../Core/index.html#type-tls_version">Core.tls_version</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>supported protocol versions (min, max)</p><span class="comment-delim">*)</span></div></li><li id="type-config.signature_algorithms" class="def record field anchored"><a href="#type-config.signature_algorithms" class="anchor"></a><code><span>signature_algorithms : <span><a href="../Core/index.html#type-signature_algorithm">Core.signature_algorithm</a> list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>ordered list of supported signature algorithms (regarding preference)</p><span class="comment-delim">*)</span></div></li><li id="type-config.use_reneg" class="def record field anchored"><a href="#type-config.use_reneg" class="anchor"></a><code><span>use_reneg : bool;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>endpoint should accept renegotiation requests</p><span class="comment-delim">*)</span></div></li><li id="type-config.authenticator" class="def record field anchored"><a href="#type-config.authenticator" class="anchor"></a><code><span>authenticator : <span><span class="xref-unresolved">X509</span>.Authenticator.t option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>optional X509 authenticator</p><span class="comment-delim">*)</span></div></li><li id="type-config.peer_name" class="def record field anchored"><a href="#type-config.peer_name" class="anchor"></a><code><span>peer_name : <span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> option</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>optional name of other endpoint (used for SNI RFC4366)</p><span class="comment-delim">*)</span></div></li><li id="type-config.own_certificates" class="def record field anchored"><a href="#type-config.own_certificates" class="anchor"></a><code><span>own_certificates : <a href="#type-own_cert">own_cert</a>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>optional default certificate chain and other certificate chains</p><span class="comment-delim">*)</span></div></li><li id="type-config.acceptable_cas" class="def record field anchored"><a href="#type-config.acceptable_cas" class="anchor"></a><code><span>acceptable_cas : <span><span class="xref-unresolved">X509</span>.Distinguished_name.t list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>ordered list of acceptable certificate authorities</p><span class="comment-delim">*)</span></div></li><li id="type-config.session_cache" class="def record field anchored"><a href="#type-config.session_cache" class="anchor"></a><code><span>session_cache : <a href="#type-session_cache">session_cache</a>;</span></code></li><li id="type-config.ticket_cache" class="def record field anchored"><a href="#type-config.ticket_cache" class="anchor"></a><code><span>ticket_cache : <span><a href="#type-ticket_cache">ticket_cache</a> option</span>;</span></code></li><li id="type-config.cached_session" class="def record field anchored"><a href="#type-config.cached_session" class="anchor"></a><code><span>cached_session : <span><a href="../Core/index.html#type-epoch_data">Core.epoch_data</a> option</span>;</span></code></li><li id="type-config.cached_ticket" class="def record field anchored"><a href="#type-config.cached_ticket" class="anchor"></a><code><span>cached_ticket : <span><span>(<a href="../Core/index.html#type-psk13">Core.psk13</a> * <a href="../Core/index.html#type-epoch_data">Core.epoch_data</a>)</span> option</span>;</span></code></li><li id="type-config.alpn_protocols" class="def record field anchored"><a href="#type-config.alpn_protocols" class="anchor"></a><code><span>alpn_protocols : <span>string list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>optional ordered list of accepted alpn_protocols</p><span class="comment-delim">*)</span></div></li><li id="type-config.groups" class="def record field anchored"><a href="#type-config.groups" class="anchor"></a><code><span>groups : <span><a href="../Core/index.html#type-group">Core.group</a> list</span>;</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>the first FFDHE will be used for TLS 1.2 and below if a DHE ciphersuite is used</p><span class="comment-delim">*)</span></div></li><li id="type-config.zero_rtt" class="def record field anchored"><a href="#type-config.zero_rtt" class="anchor"></a><code><span>zero_rtt : int32;</span></code></li><li id="type-config.ip" class="def record field anchored"><a href="#type-config.ip" class="anchor"></a><code><span>ip : <span><span class="xref-unresolved">Ipaddr</span>.t option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>configuration parameters</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ciphers13"><a href="#val-ciphers13" class="anchor"></a><code><span><span class="keyword">val</span> ciphers13 : <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Ciphersuite/index.html#type-ciphersuite13">Ciphersuite.ciphersuite13</a> list</span></span></code></div><div class="spec-doc"><p><code>ciphers13 config</code> are the ciphersuites for TLS 1.3 in the configuration.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-client"><a href="#type-client" class="anchor"></a><code><span><span class="keyword">type</span> client</span></code></div><div class="spec-doc"><p>opaque type of a client configuration</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-server"><a href="#type-server" class="anchor"></a><code><span><span class="keyword">type</span> server</span></code></div><div class="spec-doc"><p>opaque type of a server configuration</p></div></div><h2 id="constructors"><a href="#constructors" class="anchor"></a>Constructors</h2><div class="odoc-spec"><div class="spec value anchored" id="val-client"><a href="#val-client" class="anchor"></a><code><span><span class="keyword">val</span> client : 
  <span><span class="label">authenticator</span>:<span class="xref-unresolved">X509</span>.Authenticator.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?peer_name</span>:<span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?ciphers</span>:<span><a href="../Ciphersuite/index.html#type-ciphersuite">Ciphersuite.ciphersuite</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?version</span>:<span>(<a href="../Core/index.html#type-tls_version">Core.tls_version</a> * <a href="../Core/index.html#type-tls_version">Core.tls_version</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signature_algorithms</span>:<span><a href="../Core/index.html#type-signature_algorithm">Core.signature_algorithm</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reneg</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?certificates</span>:<a href="#type-own_cert">own_cert</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?cached_session</span>:<a href="../Core/index.html#type-epoch_data">Core.epoch_data</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?cached_ticket</span>:<span>(<a href="../Core/index.html#type-psk13">Core.psk13</a> * <a href="../Core/index.html#type-epoch_data">Core.epoch_data</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?ticket_cache</span>:<a href="#type-ticket_cache">ticket_cache</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?alpn_protocols</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?groups</span>:<span><a href="../Core/index.html#type-group">Core.group</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?ip</span>:<span class="xref-unresolved">Ipaddr</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-client">client</a>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>client authenticator ?peer_name ?ciphers ?version ?hashes ?reneg ?certificates ?alpn_protocols</code> is <code>client</code> configuration with the given parameters. Returns an error if the configuration is invalid.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-server"><a href="#val-server" class="anchor"></a><code><span><span class="keyword">val</span> server : 
  <span><span class="optlabel">?ciphers</span>:<span><a href="../Ciphersuite/index.html#type-ciphersuite">Ciphersuite.ciphersuite</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?version</span>:<span>(<a href="../Core/index.html#type-tls_version">Core.tls_version</a> * <a href="../Core/index.html#type-tls_version">Core.tls_version</a>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?signature_algorithms</span>:<span><a href="../Core/index.html#type-signature_algorithm">Core.signature_algorithm</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?reneg</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?certificates</span>:<a href="#type-own_cert">own_cert</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?acceptable_cas</span>:<span><span class="xref-unresolved">X509</span>.Distinguished_name.t list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?authenticator</span>:<span class="xref-unresolved">X509</span>.Authenticator.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?session_cache</span>:<a href="#type-session_cache">session_cache</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?ticket_cache</span>:<a href="#type-ticket_cache">ticket_cache</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?alpn_protocols</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?groups</span>:<span><a href="../Core/index.html#type-group">Core.group</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?zero_rtt</span>:int32 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?ip</span>:<span class="xref-unresolved">Ipaddr</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="#type-server">server</a>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p><code>server ?ciphers ?version ?hashes ?reneg ?certificates ?acceptable_cas ?authenticator ?alpn_protocols</code> is <code>server</code> configuration with the given parameters. Returns an error if the configuration is invalid.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-peer"><a href="#val-peer" class="anchor"></a><code><span><span class="keyword">val</span> peer : <span><a href="#type-client">client</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-client">client</a></span></code></div><div class="spec-doc"><p><code>peer client name</code> is <code>client</code> with <code>name</code> as <code>peer_name</code></p></div></div><h2 id="note-on-alpn-protocol-selection"><a href="#note-on-alpn-protocol-selection" class="anchor"></a>Note on ALPN protocol selection</h2><p>Both <a href="#val-client"><code>client</code></a> and <a href="#val-server"><code>server</code></a> constructors accept an <code>alpn_protocols</code> list. The list for server should be given in a descending order of preference. In the case of protocol selection, the server will iterate its list and select the first element that the client's list also advertises.</p><p>For example, if the client advertises <code>[&quot;foo&quot;; &quot;bar&quot;; &quot;baz&quot;]</code> and the server has <code>[&quot;bar&quot;; &quot;foo&quot;]</code>, <code>&quot;bar&quot;</code> will be selected as the protocol of the handshake.</p><h2 id="utility-functions"><a href="#utility-functions" class="anchor"></a>Utility functions</h2><div class="odoc-spec"><div class="spec value anchored" id="val-default_signature_algorithms"><a href="#val-default_signature_algorithms" class="anchor"></a><code><span><span class="keyword">val</span> default_signature_algorithms : <span><a href="../Core/index.html#type-signature_algorithm">Core.signature_algorithm</a> list</span></span></code></div><div class="spec-doc"><p><code>default_signature_algorithms</code> is a list of signature algorithms used by default</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-supported_signature_algorithms"><a href="#val-supported_signature_algorithms" class="anchor"></a><code><span><span class="keyword">val</span> supported_signature_algorithms : <span><a href="../Core/index.html#type-signature_algorithm">Core.signature_algorithm</a> list</span></span></code></div><div class="spec-doc"><p><code>supported_signature_algorithms</code> is a list of supported signature algorithms by this library</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-min_dh_size"><a href="#val-min_dh_size" class="anchor"></a><code><span><span class="keyword">val</span> min_dh_size : int</span></code></div><div class="spec-doc"><p><code>min_dh_size</code> is minimal diffie hellman group size in bits (currently 1024)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-supported_groups"><a href="#val-supported_groups" class="anchor"></a><code><span><span class="keyword">val</span> supported_groups : <span><a href="../Core/index.html#type-group">Core.group</a> list</span></span></code></div><div class="spec-doc"><p><code>supported_groups</code> are the Diffie-Hellman groups supported in this library.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-elliptic_curve"><a href="#val-elliptic_curve" class="anchor"></a><code><span><span class="keyword">val</span> elliptic_curve : <span><a href="../Core/index.html#type-group">Core.group</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>elliptic_curve group</code> is <code>true</code> if group is an elliptic curve, <code>false</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-min_rsa_key_size"><a href="#val-min_rsa_key_size" class="anchor"></a><code><span><span class="keyword">val</span> min_rsa_key_size : int</span></code></div><div class="spec-doc"><p><code>min_rsa_key_size</code> is minimal RSA modulus key size in bits (currently 1024)</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Ciphers"><a href="#module-Ciphers" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Ciphers/index.html">Ciphers</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Cipher selection</p></div></div><h2 id="internal-use-only"><a href="#internal-use-only" class="anchor"></a>Internal use only</h2><div class="odoc-spec"><div class="spec value anchored" id="val-of_client"><a href="#val-of_client" class="anchor"></a><code><span><span class="keyword">val</span> of_client : <span><a href="#type-client">client</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>of_client client</code> is a client configuration for <code>client</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_server"><a href="#val-of_server" class="anchor"></a><code><span><span class="keyword">val</span> of_server : <span><a href="#type-server">server</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>of_server server</code> is a server configuration for <code>server</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_authenticator"><a href="#val-with_authenticator" class="anchor"></a><code><span><span class="keyword">val</span> with_authenticator : <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">X509</span>.Authenticator.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>with_authenticator config auth</code> is <code>config</code> with <code>auth</code> as <code>authenticator</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_own_certificates"><a href="#val-with_own_certificates" class="anchor"></a><code><span><span class="keyword">val</span> with_own_certificates : <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-own_cert">own_cert</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>with_own_certificates config cert</code> is <code>config</code> with <code>cert</code> as <code>own_cert</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_acceptable_cas"><a href="#val-with_acceptable_cas" class="anchor"></a><code><span><span class="keyword">val</span> with_acceptable_cas : <span><a href="#type-config">config</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">X509</span>.Distinguished_name.t list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-config">config</a></span></code></div><div class="spec-doc"><p><code>with_acceptable_cas config cas</code> is <code>config</code> with <code>cas</code> as <code>accepted_cas</code></p></div></div></div></body></html>
